<html>
<meta content="text/html; charset=utf-8" http-equiv="content-type" />
<head>
    <script src="http://apps.bdimg.com/libs/jquery/1.11.1/jquery.min.js">
    </script>
    <script>
    var i = 0;
    var rec = 0;


    function isNumbers(e)
    {
        var keynum;
        var keychar;

        keynum = window.event ? e.keyCode : e.which;
        keychar = String.fromCharCode(keynum);
//      //alert(keynum+':'+keychar);
        var flag = false;
        console.log(keychar);
        if (e.keyCode == 13 || e.keyCode == 32){
            keychar = "0";
        }
         if($('#input1').val() == "" && e.keyCode == 188 || e.keyCode == 102){
            //keychar = "0"; == ","){
                //"." || ","||"."||"!" ||"\""||"\'")){

            $('#value2').val($('#value2').val() + keychar);
        }
        if (keychar >= "0" && keychar <= "9"){
            var select = $('#value').text().split(",")[keychar-'0'].split(":")[1].replace(" ","");

            if(select != "undefined"){
                $('#value2').val($('#value2').val() + select);
                $('#value').html("");
    //            $("input").attr("value","");
                $('#input1').val("");
                flag = true;
            }
        }

//        return flag;
//        if(!flag) {
//            OnInput(e);
//        }
    }




    // Firefox, Google Chrome, Opera, Safari, Internet Explorer from version 9
	 function OnInput (event) {
       // $('#value').html(event.target.value)	
//        $.get("127.0.0.1:8001/calc/",{'str':event.target.value}, function(ret){
//            $('#value').html(ret)		
            	//document.getElementById("value").innerHTML = event.target.value;
  //          }
//         isNumbers(event);
         if (event.target.value[event.target.value.length -1] >= "0"
                 && event.target.value[event.target.value.length -1] <= "9"){
             $('#input1').val("");
         }

         if (event.target.value != ""){
 	        $.ajax({
       		   	 url : "/calc/", // the endpoint
       			 type : "POST", // http method
    			 data : { "pinyin":event.target.value, 'num':i}, // data sent with the post request
                async: false,
                success : function(ret) {
		//        if(ret["num"] >= rec){
                    console.log(ret)
                    $('#value').html(unescape((ret["hanzi"].replace(/\\u/g, '%u')))
                            .replace("{","") .replace("}","").replace(/"/g,""));
//                    $.each(ret.hanzi,function(key,value){
//                        $("#value").append("<div>" + value + "</div>" + "<br/> <hr/>");
//                     });
                    //$('#value').html(ret['hanzi']); // remove the value from the input
	    	        rec = ret["num"];
//    $.each(ret.hanzi, function(i, item) {
//      $("#value").append(
//          "<div>" + i + "</div>" +
//          "<div>" + item + "</div><hr/>");
//    });
//    });
               // }
		          console.log(ret["num"]); // log the returned json to the console
          	      console.log("success"); // another sanity chec
 	         },
        	    error: function(xhr,errmsg,err) {
                      console.log("failure");
		        }
 	        });
               i = i + 1;
	}else{
        	$('#value').html(""); // remove the value from the input
	}

 }
    // Internet Explorer
        function OnPropChanged (event) {
            if (event.propertyName.toLowerCase () == "value") {
                  document.getElementById("value").innerHTML = event.srcElement.value;
            }
        }
    </script>
</head>
<body>
   <p> pinyin输入法demo程序</p>
   <form action="/calc/" method="post">
    <input type="text" onkeyup="value=value.replace(/[^a-z]/g,'')" id="input1" style="width:100%;height:30px;border:3px solid blue;margin:10px 0"
        oninput="OnInput(event)" onkeydown="isNumbers(event)" value=""/>
    <div id="value" style="width:100%;height:30px;border:3px solid red;margin:10px 0"></div>
    <input id="value2" style="width:100%;height:30px;border:3px solid red;margin:10px 0"/>
   </form>
   <!--<input type="text"  onkeydown="return noNumbers(event)" />-->
</body>
</html>

